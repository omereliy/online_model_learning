#!/bin/bash
# Pre-Commit Test Hook
# Ensures all tests pass before allowing a commit (TDD enforcement)

# Color codes
RED='\033[0;31m'
GREEN='\033[0;32m'
NC='\033[0m'

echo -e "${GREEN}üõ°Ô∏è Running Tests Before Commit${NC}"
echo "----------------------------------------"

# Find project root
PROJECT_ROOT=$(git rev-parse --show-toplevel 2>/dev/null)
if [ -z "$PROJECT_ROOT" ]; then
    echo -e "${RED}Error: Not in a git repository${NC}"
    exit 1
fi

cd "$PROJECT_ROOT"

# Run test suite
echo "Running: make test"
make test

# Check result
if [ $? -ne 0 ]; then
    echo ""
    echo -e "${RED}‚ùå Tests failed - commit blocked${NC}"
    echo ""
    echo "Fix failing tests before committing."
    echo "To bypass (emergency only): git commit --no-verify"
    echo ""
    exit 1
fi

echo ""
echo -e "${GREEN}‚úÖ All tests passed - proceeding with commit${NC}"
echo ""